# Terraform Module: Azure \[Governance\] - Management Groups

This Terraform module creates and manages **Azure Management Groups (MGs)** with optional subscription associations. It supports **nested management groups**, dynamic subscription assignment using **subscription ID prefixes**, and is designed for governance-focused landing zones. 

**Note:** Subscriptions are to be provided using the data object "azurerm_subscriptions" as the input variable is a map of objects. 

---

## Features

- Creates a **root management group**. 
- Creates management groups up to **four levels nested**. 
- Automatically assign subscriptions to MGs based on **first 3 segments of subscription IDs**. 
- Supports **multiple subscriptions per MG**. 
- Supports **nested MGs**, with parent-child relationships explicitly defined. 
- Designed to work with **Azure Policy assignments** and role-based access control (RBAC). 

---

## Usage

```hcl
data "azurerm_subscriptions" "all" {} # Get all subscriptions visible to current identity. 

module "management-groups" {
  source                   = "../../modules/gov-management-groups"
  subscriptions            = data.azurerm_subscriptions.all # Pass in all subscriptions. 
  naming_prefix            = var.global.naming.org_prefix   # "abc"
  management_group_core    = data.azurerm_management_group.core
  management_groups_level1 = var.management_groups_level1
  management_groups_level2 = var.management_groups_level2
  management_groups_level3 = var.management_groups_level3
  management_groups_level4 = {} # Leave blank to exclude this level. 
  management_groups_level5 = {} # Leave blank to exclude this level.
}
```

<!-- BEGIN_TF_DOCS -->
<!-- Code generated by terraform-docs. DO NOT EDIT. -->


<!-- markdownlint-disable MD033 -->
## Requirements

No requirements.

## Resources

| Name | Type |
|------|------|
| [azurerm_management_group.level1](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/management_group) | resource |
| [azurerm_management_group.level2](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/management_group) | resource |
| [azurerm_management_group.level3](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/management_group) | resource |
| [azurerm_management_group.level4](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/management_group) | resource |
| [azurerm_management_group.root](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/management_group) | resource |

<!-- markdownlint-disable MD013 -->
## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_global"></a> [global](#input\_global) | Map of global variable configuration values. | `map(map(string))` | n/a | yes |
| <a name="input_management_group_root"></a> [management\_group\_root\_id](#input\_management\_group\_root) | Name ID to use for the top-level (root) Management Group. | `string` | n/a | yes |
| <a name="input_management_groups_level1"></a> [management\_groups\_level1](#input\_management\_groups\_level1) | Map of first level Management Group objects, nested under the root Manangement Group. | <pre>map(object({<br/>    display_name           = string<br/>    subscription_id_filter = optional(list(string)) # Optional list of subscription prefixes (3 segments). <br/>  }))</pre> | n/a | yes |
| <a name="input_management_groups_level2"></a> [management\_groups\_level2](#input\_management\_groups\_level2) | Map of second level Management Group objects, nested under defined parent Management Group. | <pre>map(object({<br/>    display_name           = string<br/>    subscription_id_filter = optional(list(string)) # Optional list of subscription prefixes (3 segments). <br/>    parent_mg_name         = string<br/>  }))</pre> | n/a | yes |
| <a name="input_management_groups_level3"></a> [management\_groups\_level3](#input\_management\_groups\_level3) | Map of third level Management Group objects, nested under defined parent Management Group. | <pre>map(object({<br/>    display_name           = string<br/>    subscription_id_filter = optional(list(string)) # Optional list of subscription prefixes (3 segments). <br/>    parent_mg_name         = string<br/>  }))</pre> | n/a | yes |
| <a name="input_management_groups_level4"></a> [management\_groups\_level4](#input\_management\_groups\_level4) | Map of fourth level Management Group objects, nested under defined parent Management Group. | <pre>map(object({<br/>    display_name           = string<br/>    subscription_id_filter = optional(list(string)) # Optional list of subscription prefixes (3 segments). <br/>    parent_mg_name         = string<br/>  }))</pre> | n/a | yes |
| <a name="input_naming_prefix"></a> [naming\_prefix](#input\_naming\_prefix) | String value used for resource naming. | `string` | n/a | yes |
| <a name="input_subscriptions"></a> [subscriptions](#input\_subscriptions) | List of all subscriptions available in tenant. | <pre>list(object({<br/>    display_name          = string<br/>    id                    = string<br/>    location_placement_id = string<br/>    quota_id              = string<br/>    spending_limit        = string<br/>    state                 = string<br/>    subscription_id       = string<br/>    tags                  = map(string)<br/>    tenant_id             = string<br/><br/>  }))</pre> | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_management_group_subscriptions"></a> [management\_group\_subscriptions](#output\_management\_group\_subscriptions) | n/a |
| <a name="output_management_groups_subs_level1"></a> [management\_groups\_subs\_level1](#output\_management\_groups\_subs\_level1) | n/a |
| <a name="output_management_groups_subs_level2"></a> [management\_groups\_subs\_level2](#output\_management\_groups\_subs\_level2) | n/a |
| <a name="output_management_groups_subs_level3"></a> [management\_groups\_subs\_level3](#output\_management\_groups\_subs\_level3) | n/a |
| <a name="output_management_groups_subs_level4"></a> [management\_groups\_subs\_level4](#output\_management\_groups\_subs\_level4) | n/a |

## Modules

No modules.

<!-- END_TF_DOCS -->
